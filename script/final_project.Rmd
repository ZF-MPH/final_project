---
title: "final_project_mkdn"
author: "Zach F, Elizabeth B, & Esmeralda C"
date: "11/10/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##Load Packages
```{r}
library(tidyverse)
library(rio)
library(here)
library(janitor)
library(naniar)
```

##Load Data
```{r}
demographics <- import(here("data", "Teen-Demographic-SPSS(1) copy.zip"))

phys_act <- import(here("data", "Teen-PA-SPSS(1) copy.zip"))

```

## Joined Data
```{r}
joined_set <- demographics %>% full_join(phys_act, by = "PID")

join1 <- joined_set %>% 
  as_tibble() %>%
  select(PID, TSEX, TSCHLTYPE, TETHRAC_RC, TGRADE, TAGE) %>% 
  characterize(c(TSEX, TSCHLTYPE, TETHRAC_RC, TGRADE, TAGE))

join2 <- joined_set %>% 
  select(PID,XTHEIGHTCM_RC, XTWEIGHTKG_RC, TETHRAC_RC, TPMPABAD, TPMPAWANT, TPMPAUPST, TPMPAIMPT, XTPREDWEEKS, XTPREDWEEKOFS, XTPREDWEEKW, TAGE)

full_joined_set <- join2 %>% full_join(join1, by = "PID")
```

## Convert "-9" to "NA" and ridding any rows with "NAs"
```{r}
final_joined <- full_joined_set %>% 
  replace_with_na_all(condition = ~.x == -9) %>% 
  na.omit(full_joined_set)
```


## Ages 13-18 (teenagers) only
```{r}
teenage_only <- final_joined %>% 
  filter(TAGE.x >= 3)
```

## Teenagers With BMI Calculated )
__teen_w_bmi__ is our data set to use and create visualizations
```{r}
teen_w_bmi <- teenage_only %>% 
  mutate(height_meters = XTHEIGHTCM_RC / 100) %>% 
  mutate(bmi = XTWEIGHTKG_RC/(height_meters^2)) %>%
  mutate(total_pa_wk_min = XTPREDWEEKS + XTPREDWEEKOFS + XTPREDWEEKW)
```


## Grouping by School Type and Sex to Summarize Mean Age and Mean Total Weekly PA
```{r}
teen_w_bmi %>%
  group_by(TSCHLTYPE, TSEX) %>%
  summarize(mean_age = mean(TAGE.x + 10), 
            mean_total_PA = mean(total_pa_wk_min)) %>% 
  as_tibble()

# Need to make it to where we can see 5 total characters (so we can have two decimal points for the mean_total_PA)
# Also, there are 4 remaining rows that have a "not ascertained" for TSEX. Need to get rid of these.
```




*__!!!!EVERYTHING BELOW THIS IS OLD DRAFT!!!!__*
__ALL FINALIZED CODING SHOULD GO IN THE TOP PORTION - Practice can be done below this line!__




## Join Data
Datasets were **joined** (demographics dataset and physical activity dataset)
```{r}
library(tidyverse)
library(rio)
library(here)
library(janitor)
demographics <- import(here("data", "Teen-Demographic-SPSS(1) copy.zip"))

phys_act <- import(here("data", "Teen-PA-SPSS(1) copy.zip"))

# joined demographics and PA-questionnaire by participant ID "PID"
joined_set <- demographics %>% full_join(phys_act, by = "PID")

#try left_join and decide which to use, based on what data/variables we want

joined_set_revise <- demographics %>% left_join(phys_act, by = "PID")
#suggestion from Prof Nese
joined_set_revise %>% 
  as_tibble() %>%
  select(TSEX, TSCHLTYPE, TETHRAC_RC) %>% 
  characterize(c(TSEX, TSCHLTYPE, TETHRAC_RC))
#select so we only see what we're characterizing 

# selecting only variables that we may use
selected_variables <- joined_set %>% 
  select(TAGE, TGRADE, TSEX, TSCHLTYPE, XTHEIGHTCM_RC, XTWEIGHTKG_RC, TETHRAC_RC, TPMPABAD, TPMPAWANT, TPMPAUPST, TPMPAIMPT, XTPREDWEEKS, XTPREDWEEKOFS, XTPREDWEEKW)

selected_variables %>% as_tibble() %>%
  characterize(c("TSEX", "TSCHLTYPE", "TETHRAC_RC"))  

#characterize race, sex, and school type 
```

## Filter and Mutate
We **filtered** to only show _high school respondents_ & then used **mutate()**
to create a column for BMI (calculated from height/weight
```{r}
highschool_only <- selected_variables %>% 
  filter(TAGE >= 14 | TAGE < 18) %>% 
  filter(!is.na(TAGE))

HS_W_BMI <- highschool_only %>% 
  mutate(Height_M = XTHEIGHTCM_RC / 100) %>% 
  mutate(BMI = XTWEIGHTKG_RC/(Height_M^2)) %>%
  mutate(total_PA = XTPREDWEEKS + XTPREDWEEKOFS + XTPREDWEEKW)
```

## Commit 3
```{r}
HS_W_BMI %>%
  group_by(TSCHLTYPE, TSEX) %>%
  summarize(mean_age = mean(TAGE), mean_total_PA = mean(total_PA, na.rm= TRUE))

longer_hs <- highschool_only %>% 
  pivot_longer(
    cols = starts_with("XTPREDWEEK"), 
    names_to = "MVPA(source)", 
    values_to = "minutes", 
    values_drop_na = TRUE)

longer_hs2 <- highschool_only %>% 
  pivot_longer(
    cols = starts_with ("TPMPA"), 
    names_to = "TP")

 wider_hs <- highschool_only %>%
    pivot_wider(
     names_from = c(TGRADE,TSEX), 
     values_from = XTPREDWEEKS,
     values_fn = list(XTPREDWEEKS = mean))
 #doesn't make sense so will change, but it does make it wider! 

#come back to this to get rid of the -9
# next up: pivot_wider and pivot_longer
```

ZACH TEST (Turns all "-9" into "NA") (This worked)
```{r}
library(naniar)
NAs_HS_W_BMI <- HS_W_BMI %>% 
  replace_with_na_all(condition = ~.x == -9)
```

ZACH TEST to get rid of all rows containing NA (this worked)
```{r}
omit_HS_W_BMI <- na.omit(NAs_HS_W_BMI)

# TRIED to use characterize here, and it did nothing
```
## Esme Visual Plot- In Progress..
```{r}
omit_HS_W_BMI %>% 
  ggplot(aes(BMI, total_PA)) +
  geom_point(aes(color = TSEX)) +
  facet_wrap(~TETHRAC_RC) +
  theme_minimal() +
  labs(y = "Total Physical Activity per Week",
       x = "Body Mass Index",
       title = "Physical Activity and Body Mass Index")

# may look for something other than BMI
```

## ZACH trying to fix characterize issues
```{r}
join1 <- joined_set %>% 
  as_tibble() %>%
  select(PID, TSEX, TSCHLTYPE, TETHRAC_RC, TGRADE) %>% 
  characterize(c(TSEX, TSCHLTYPE, TETHRAC_RC, TGRADE))

join2 <- joined_set %>% 
  select(PID,XTHEIGHTCM_RC, XTWEIGHTKG_RC, TETHRAC_RC, TPMPABAD, TPMPAWANT, TPMPAUPST, TPMPAIMPT, XTPREDWEEKS, XTPREDWEEKOFS, XTPREDWEEKW)

try_joined_set <- join2 %>% full_join(join1, by = "PID")
```
**try_joined_set** worked!!!!!

