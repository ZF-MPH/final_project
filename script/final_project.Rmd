---
title: "final_project_mkdn"
author: "Zach F, Elizabeth B, & Esmeralda C"
date: "11/10/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Join Data
Datasets were **joined** (demographics dataset and physical activity dataset)
```{r}
library(tidyverse)
library(rio)
library(here)
library(janitor)
demographics <- import(here("data", "Teen-Demographic-SPSS(1) copy.zip"))

phys_act <- import(here("data", "Teen-PA-SPSS(1) copy.zip"))

# joined demographics and PA-questionnaire by participant ID "PID"
joined_set <- demographics %>% full_join(phys_act, by = "PID")

#trying to characterize our original joined set in the same way Dr. Nese did. . . HOW do we get it to work while still using all the variables we need?

joined_set_chz <- demographics %>% full_join(phys_act, by = "PID") %>% 
  select(TAGE, TGRADE, TSEX, TSCHLTYPE, XTHEIGHTCM_RC, XTWEIGHTKG_RC, TETHRAC_RC, TPMPABAD, TPMPAWANT, TPMPAUPST, TPMPAIMPT, XTPREDWEEKS, XTPREDWEEKOFS, XTPREDWEEKW) %>%
  characterize(c(TSEX, TSCHLTYPE, TETHRAC_RC))
  

#try left_join and decide which to use, based on what data/variables we want

joined_set_revise <- demographics %>% left_join(phys_act, by = "PID")
#suggestion from Prof Nese
joined_set_revise %>% 
  as_tibble() %>%
  select(TSEX, TSCHLTYPE, TETHRAC_RC) %>% 
  characterize(c(TSEX, TSCHLTYPE, TETHRAC_RC))
#select so we only see what we're characterzing 

# selecting only variables that we may use
selected_variables <- joined_set %>% 
  select(TAGE, TGRADE, TSEX, TSCHLTYPE, XTHEIGHTCM_RC, XTWEIGHTKG_RC, TETHRAC_RC, TPMPABAD, TPMPAWANT, TPMPAUPST, TPMPAIMPT, XTPREDWEEKS, XTPREDWEEKOFS, XTPREDWEEKW)

selected_variables %>% as_tibble() %>%
  characterize(c("TSEX", "TSCHLTYPE", "TETHRAC_RC"))  

#characterize race, sex, and school type 
```

## Filter and Mutate
We **filtered** to only show _high school respondents_ & then used **mutate()**
to create a column for BMI (calculated from height/weight
```{r}
highschool_only <- selected_variables %>% 
  filter(TAGE >= 14 | TAGE < 18) %>% 
  filter(!is.na(TAGE))

HS_W_BMI <- highschool_only %>% 
  mutate(Height_M = XTHEIGHTCM_RC / 100) %>% 
  mutate(BMI = XTWEIGHTKG_RC/(Height_M^2)) %>%
  mutate(total_PA = XTPREDWEEKS + XTPREDWEEKOFS + XTPREDWEEKW)
```

## Commit 3
```{r}
HS_W_BMI %>%
  group_by(TSCHLTYPE, TSEX) %>%
  summarize(mean_age = mean(TAGE), mean_total_PA= mean(total_PA, na.rm= TRUE))

longer_hs <- highschool_only %>% 
  pivot_longer(
    cols = starts_with("XTPREDWEEK"), 
    names_to = "MVPA(source)", 
    values_to = "minutes", 
    values_drop_na = TRUE)

longer_hs2 <- highschool_only %>% 
  pivot_longer(
    cols = starts_with ("TPMPA"), 
    names_to = "TP")

 wider_hs <- highschool_only %>%
    pivot_wider(
     names_from = c(TGRADE,TSEX), 
     values_from = XTPREDWEEKS,
     values_fn = list(XTPREDWEEKS = mean))
 #doesn't make sense so will change, but it does make it wider! 

#come back to this to get rid of the -9
# next up: pivot_wider and pivot_longer
```

ZACH TEST (Turns all "-9" into "NA") (This worked)
```{r}
library(naniar)
NAs_HS_W_BMI <- HS_W_BMI %>% 
  replace_with_na_all(condition = ~.x == -9) %>% 
  characterize()
```

ZACH TEST to get rid of all rows containing NA (this worked)
```{r}
omit_HS_W_BMI <- na.omit(NAs_HS_W_BMI)

# TRIED to use characterize here, and it did nothing
```
## Esme Visual Plot- In Progress..
```{r}
omit_HS_W_BMI %>% 
  ggplot(aes(BMI, total_PA)) +
  geom_point(aes(color = TSEX)) +
  facet_wrap(~TETHRAC_RC) +
  theme_minimal() +
  labs(y = "Total Physical Activity per Week",
       x = "Body Mass Index",
       title = "Physical Activity and Body Mass Index")

# may look for something other than BMI
```

## ZACH trying to fix characterize issues
```{r}
join1 <- joined_set %>% 
  as_tibble() %>%
  select(PID, TSEX, TSCHLTYPE, TETHRAC_RC, TGRADE) %>% 
  characterize(c(TSEX, TSCHLTYPE, TETHRAC_RC, TGRADE))

join2 <- joined_set %>% 
  select(PID,XTHEIGHTCM_RC, XTWEIGHTKG_RC, TETHRAC_RC, TPMPABAD, TPMPAWANT, TPMPAUPST, TPMPAIMPT, XTPREDWEEKS, XTPREDWEEKOFS, XTPREDWEEKW)

try_joined_set <- join2 %>% full_join(join1, by = "PID")
```
**try_joined_set** worked!!!!!

